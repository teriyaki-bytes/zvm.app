---
---
<script type="module">
  import posthog from 'posthog-js';

  // Prevent double init across client-side navigations
  if (!(window).posthogInitialized) {
    posthog.init('phc_pmCPcYSLQqv06mndbli5nhdgbrkYarDNK1m6iPqqTo2', {
      api_host: 'https://us.i.posthog.com',
      defaults: '2025-11-30',
      capture_pageview: true,
      autocapture: true,
    });
    (window).posthogInitialized = true;
  }

  // Generic click capture for elements marked with data-ph-event
  function attachListener() {
    if ((window).posthogClickListenerAttached) return;
    (window).posthogClickListenerAttached = true;

    document.addEventListener(
      'click',
      (evt) => {
        const target = evt.target.closest?.('[data-ph-event]');
        if (!target) return;
        const name = target.getAttribute('data-ph-event');
        if (!name) return;
        posthog.capture(name, {
          href: target.getAttribute('href') || undefined,
          text: target.textContent?.trim().slice(0, 120) || undefined,
          id: target.id || undefined,
        });
      },
      true
    );
  }

  attachListener();
  document.addEventListener('astro:after-swap', attachListener);
</script>
